
.\"
.TH store_dir 1  26-November-2007  "DRMS MANPAGE" "DRMS Programmer's Manual"
.SH NAME
store_dir, retrieve_dir, store_file, retrieve_file \- store files in and retrieve files from a SUMS directory.
.SH SYNOPSIS
.nf
.B store_dir \fR[\fB-cv\fRDRIVER_FLAGS] \fBseries=\fR<series_name> \fBdirname=\fR<prefix>/<subdir> \fBsel=\fR<sel_text> [\fBnote=\fR<note_text>] [\fBperm=0\fR|\fB1\fR]
.B retrieve_dir \fR[\fB-l\fRDRIVER_FLAGS] \fBseries=\fR<record_set> \fBto=\fR<dest> [\fBdirkey=\fR<dirname_keyword>]
.B store_file \fR[\fB-chv\fRDRIVER_FLAGS] \fBds=\fR<series_name> \fBin=\fR<file> [\fBsel=\fR<sel_text>] [\fBnote=\fR<note_text>] [\fBperm=0\fR|\fB1\fR]
.B retrieve_file \fR[\fB-fhlv\fRDRIVER_FLAGS] \fBds=\fR<record_set> \fBout=\fR<dest> [\fBsegment=\fR<segment_name>]

.SH DESCRIPTION
.PP
store_dir and retrieve_dir are a pair of utilities to store (and retrieve) an arbitrary 
directory of files to (from) DRMS/SUMS. Files stored with store_dir can be easily retrieved by 
the retrieve_dir utility. store_file and retrieve_file provide the analogous functionality
for a single file.
.PP
If the series <series_name> does not exist, store_dir will first create that series,
provided that the user supplies the \fBc\fR flag. If \fBperm=1\fR, then the series will be 
globally accessible, otherwise, only the user calling store_dir will have access.
store_dir then creates a record in the series <series_name> and creates a subdirectory, 
<subdir>, in the record's SUMS directory (for each record there is a single SUMS 
directory). store_dir copies all files from <prefix>/<subdir> to <subdir> in the 
record's SUMS directory. It also stores <prefix>/<subdir> 
in the record's \fBdirname\fR keyword value so that retrieve_dir can locate the subdirectory
within the SUMS directory that contains the files. sel=<sel_text> and note=<note_text> 
allow the user to link additional information to the record to facilitate the subsequent
search for files in the series. They set the record's \fBsel\fR and \fBnote\fR keywords 
to have the values <sel_text> and <note_text>, respectively. In particular, \fB<sel>\fR
can be used to differentiate between multiple calls to store_dir with the same value 
for <prefix>/<subdir>.
The series <series_name> 
must contain prime keywords named \fBdirname\fR and \fBsel\fR, and it must contain the keyword
named \fBnote\fR.
.PP
For retrieve_dir, <record_set> is a database query that allows the user to select 
a subset of records of a series. In particular, the user can supply values for the
\fBsel\fR and \fBnote\fR keywords in <record_set> to search for files saved with store_dir.
retrieve_dir retrieves the set of records specified, 
and for each record uses the value contained within the <dirname_keyword> keyword 
(defaults to \fBdirname\fR) to
identify the subdirectory within the record's SUMS directory (i.e., 
it is all of the string after the last '/' in this value) that contains the record's 
files. It then copies (or links, if the \fBl\fR flag is present) all files from
this subdirectory to a identically named subdirectory of the directory specified by <dest>.
Typically, the files retrieved with retrieve_dir have been stored into SUMS
with the store_dir utility.  retrieve_dir will overwrite any files existing in the destination 
subdirectory whose name matches the name of a file to be copied from
a SUMS subdirectory.  If the link flag, \fBl\fR,
is specified, then retrieve_dir will create a link to the SUMS subdirectory instead of 
copying from the SUMS subdirectory to the destination subdirectory.  Keep in mind that over time
this link may become broken as SUMS may remove a stored file if it is present in SUMS 
longer than its specified retention time.
.PP
For store_file, <file> is the full path of the file that will be stored in SUMS
in the dataseries <series_name>. The series <series_name> must contain prime keywords
named \fBfile\fR and \fBsel\fR, and it must contain the keyword named \fBnote\fR.
.PP
For each file in the record set specified by <record_set>, retrieve dir will copy the
record segment's file to <dest>. If the series contains more than one segment, <segment_name>
must be present.  Since the name of a segment's file is the segment name,
any file in <dest> whose name matches the segment's name will be overwritten. However,
a backup will be saved (the file will be renamed with a \fB~\fR suffix) if an overwrite it 
to occur, unless the \fBf\fR flag is specified.  retrieve_dir prints to stdout the
list of files retrieved, or NOT_FOUND if a file cannot be found. It also prints the contents
of the \fBnote\fR keyword value.
.PP
Example to store a directory of files:

  store_dir series=su_arta.TestStoreDir dirname=/auto/home2/arta/savedFilesJanuary sel=January 
note="All my January work"

Example to retrieve a directory of files:

  retrieve_dir series=su_arta.TestStoreDir to=/auto/home2/arta/restoredFilesJanuary/ dirkey=dirname

Example to store a single file:

  store_file in=0000.fits ds=myseries sel=test002 note= "fits file from test002"

Example to retrieve a single file:

  retrieve_file ds=myseries[][test002]

.SH FLAGS
.SS module-specific flags
.IP \fB-c\fR 20
Silently create the series <series_name> if it does not exist.
.IP \fB-f\fR 20
Force removal of a pre-existing file with same name as retreived file.
.IP \fB-h\fR 20
Print usage message and exit
.IP \fB-l\fR 20
Create a symbolic link to the SUMS directory containing the file(s) of interest.
.IP \fB-v\fR 20
Run in verbose mode.
.SS driver flags
.IP \fB-H\fR|\fB--help\fR 20
Show jsoc_main usage information.
.IP \fB-L\fR 20
Run jsoc_main driver without logging.
.IP \fB-V\fR 20
Run jsoc_main driver in verbose mode.
.IP \fB-Q\fR 20
Run jsoc_main driver in quiet mode (no terminal output).

.SH ARGUMENTS
.IP <series_name> 20 
Specifies the series, <series_name>, to which the file-referring record will be added.
Should a record-set specifier be provided, it will be ignored.
.IP <prefix>/<subdir> 20
The local full path that contains the files to be stored in SUMS. The record created will contain 
a prime keyword named \fBdirname\fR whose value will be <prefix>/<subdir>.
.IP <sel_text> 20
<sel_text> contains a string that will be the keyword value for the \fBsel\fR prime keyword of the 
record created. This extra prime keyword facilitates selection between multiple 
records containing equivalent values for the \fBdirname\fR (store_dir) or /fBfile\fR (store_file)
keyword (it may be desirable to save files in the same directly repeatedly, or save the same
file over time).
.IP <note_text> 20
An optional string that will be the keyword value for the \fBnote\fR keyword of the record created.
.IP \fBperm=0\fR|\fB1 20
Relevant only when the \fBc\fR flag is used and a series is created.  A perm of 0 will make the 
created series accessible only by the current user.  A perm of 1 will make the series globally
accessible.
.IP <record_set> 20
A series name followed by a record-set specification. Causes selection of a subset of 
records in the series.
A series name followed by an optional record set filter 
(i.e., <name>[RecordSet_filter]).  Each record retrieved with this <record_set> query
will refer to one directory/file that will be copied to <dest>.
.IP <dest> 20
The destination directory to which the SUMS file(s) should be copied/linked.  
Do not append a final '/' to the path (i.e., /home/arta/dir1 is acceptable, but /home/arta/dir1/
is not)
.IP <dirname_keyword> 20
Name of the keyword containing the path of the directory originally
stored with store_dir.
.IP <file> 20
Full path of the file to store. Only the filename (everything after the last '/') 
will be stored in the \fBfile\fR keyword.
.IP <segment_name> 20
Name of the segment whose file should be retrieved.
