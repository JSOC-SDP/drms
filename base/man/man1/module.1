.\"
.TH module 1  2007-11-28 "DRMS MANPAGE" "DRMS Programmer's Manual"
.SH NAME
module \- do what the module does
.SH SYNOPSIS
.B module
\fI[-nAHLQV] [argument= value ...]\fR
.SH DESCRIPTION
Execute the named \fImodule\fR from a shell.  When a module is executed
from the command line, all argument values listed in the module are supplied
from (in order of precedence): values on the command line; values in a
named parameter file; or the default values
specified in the module, if any.  If any arguments cannot be otherwise
evaluated, a notification message is issued and the driver program exits.
If all the argument values exist, a drms session is opened or a connection
is made to an existing drms server as appropriate, and the module is executed.
At the end of module execution, the driver disconnects from the drms with
or without commits to the database depending on the exit status of the module.
No commits are ever made when a module aborts or is killed on a signal.

Modules are expected to run as functions (or subroutines) called by a main
driver program that parses the argument list from the command line and
environment, and sets up the \fIdrms->env\fR environment for communication
with the DRMS database via the DRMS API. Different driver programs can be
made available, depending on the environment. Two such programs are provided
as part of the base system, \fIjsoc_main\fR and \fIjsoc_main_sock\fR.
The former provides a direct connection to the DRMS, for use by self-contained
modules. The latter provides communication via a socket; it can be used for
multiple modules connecting to a common server, as in a script. When multiple
clients connect to a common server, commits to the database will only occur
at the successful close of the server. Modules linked against \fIjsoc_main\fR
are given their basename for the executable, while those linked against
\fIjsoc_main_sock\fR have "_sock" appended to the basename. For example,
a module named myprogram.c would produce executables named myprogram and
myprogram_sock. (Additional drivers to produce, for example, CGI scripts
such as myprogram_cgi can also be provided.)

The \fB\-H\fR option prints out the list of required arguments and their
default or set values, then quits. (The argument \fB--help\fR has
the same effect.)  The \fB\-V\fR option
prints the full argument list before execution of the module; it also
set the \fBdrms_env->verbose\fR element and may forces printing of some diagnostic
messages by the module driver. The \fB\-n\fR flag is reserved by \fIjsoc_main\fR
but is not currently used.

The \fB\-L\fR flag forces logging of all module messages to \fIstdout\fR and
\fIstderr\fR to a DRMS session log.
The \fB\-Q\fR option suppresses messages form the module to stdout and
stderr, although the messages are still sent to the DRMS session log.
Without session logging turned on, the \fB\-Q\fR flag has no effect.
The \fB\-A\fR flag forces archiving of all segments (including the logging)
in SUMS to tape, if that is an option. If it is not set, then archiving
is turned off. It is not clear how the presence or absence of this flag
interacts with the archiving options defined for the data series.

All flags (except of course \fB\-H\fR) are available to be passed down to
the module. White space between the '=' sign and the argument value is
optional. Flags can be concatenated as shown in the synopsis.

.NXR ""
.SH OPTIONS
.NXR "module command" "options"
.IP \fBargument=\fIvalue\fR 20
The value of the argument.

There are several argument and flag names reserved by the main driver
program. None of these need ordinarily be changed from their default
values:
.NXR "module command" "options"
.IP \fBJSOC_DBHOST=\fIname\fR
The hostname of the DRMS database server. The default name is defined in
serverdefs.h
.IP \fBJSOC_DBNAME=\fIname\fR
The name of the database to be used; default defined in serverdefs.h
.IP \fBJSOC_DBUSER=\fIname\fR
The user ID for access to the database; default NULL, in which case the
information in the user's .pgpass file is used.
.IP \fBJSOC_DBPASSWD=\fIname\fR
The user password for access to the database; default NULL (ditto).
.IP \fBJSOC_SESSIONNS=\fIname\fR
The database name space for the session; default: NULL ()
.IP \fBDRMS_RETENTION=\fIn\fR
The value to be used for drms_env->retention. This is the retention time
in days for storage units created by the session. It does not relate
to storage for output records in definedd data series. Default: -1
(no retention).
.IP \fBDRMS_QUERY_MEM=\fIn\fR
The maximum amount of memory (in MB) to be used by a single record query
from the DRMS; default: 512
.IP \fBDRMSSESSION=\fIname\fR
used by jsoc_main_sock only
.IP \fBDRMS_SERVER_WAIT=\fIn\fR
used by jsoc_main_sock only

.SH EXAMPLES
There are a few heuristic sample modules in \fIproj/example/apps\fR as
well as the real modules in base/util/apps and base/drms/apps (not,
however, drms_server.c nor masterlists.c).
.SH FILES
$HOME/.pgpass
.SH SEE ALSO
.B params_get(3)
.B cmdparams_parse(3)
.R drms_env(3)
.B module_args(5)
.SH BUGS
The sample modules may be very much out of date with respect to the features
available.
